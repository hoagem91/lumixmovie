<div class="dashboard-container">
  <!-- Top Bình Luận Section -->
  <section class="top-comments-section">
    <h2 class="section-title">
      <i class="fas fa-medal ct-icon"></i>
      TOP BÌNH LUẬN
    </h2>

    <div class="carousel-wrapper">
      <!-- Navigation Buttons -->
      <button class="carousel-nav prev"
              (click)="prevSlide()"
              *ngIf="comments.length > cardsPerView">
        <i class="fas fa-chevron-left"></i>
      </button>

      <div class="carousel-container"
           #carouselContainer
           (mouseenter)="onCarouselMouseEnter()"
           (mouseleave)="onCarouselMouseLeave()"
           (touchstart)="onTouchStart($event)"
           (touchend)="onTouchEnd($event)">
        <div class="carousel-track" #carouselTrack>
          <div class="comment-card" *ngFor="let comment of comments; let i = index">
            <div class="comment-content" style="height: 100%" (click)="onMoveClick(comment.movieId)">
              <div class="card-background" [style.backgroundImage]="'url(' + comment.posterUrl+ ')'"></div>
              <div class="card-overlay"></div>

              <div class="card-content">
                <div class="user-info">
                  <div class="user-details">
                    <div class="username-row">
                      <i class="fas fa-user" style="color: #ffd875;font-size: 10px;"></i>
                      <span class="username">{{ comment.username }}</span>
                    </div>
                  </div>
                </div>
                <img class="img-movie" [src]="comment.posterUrl" [alt]="comment.movieTitle">
                <p class="comment-text">{{ comment.content }}</p>
                <div class="movie-info">
                  <i class="fa-solid fa-play icon-play"></i>
                  <p class="movie-content">{{comment.movieTitle}}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <button class="carousel-nav next"
              (click)="nextSlide()"
              *ngIf="comments.length > cardsPerView">
        <i class="fas fa-chevron-right"></i>
      </button>

      <!-- Dots Indicators - Hiển thị theo số slides thực tế -->
      <div class="carousel-dots" *ngIf="getTotalSlides() > 1">
        <span class="dot"
              *ngFor="let slide of getSlidesArray(); let i = index"
              [class.active]="i === currentSlideIndex"
              (click)="goToSlide(i)">
        </span>
      </div>
    </div>
  </section>

  <!-- Bottom Grid Section -->
  <div class="bottom-grid">
    <!-- Sôi Nổi Nhất -->
    <section class="grid-item">
      <h3 class="section-subtitle">
        <i class="fa-solid fa-clapperboard ct-icon"></i>
        SÔI NỔI NHẤT
      </h3>
      <div class="trending-list">
        <div class="trending-item" *ngFor="let item of movies | slice:0:5; let i = index" (click)="onMoveClick(item.id)">
          <span class="rank">{{ i + 1 }}.</span>
          <img [src]="item.posterUrl" [alt]="item.title" class="trending-thumb">
          <span class="trending-title">{{ item.title }}</span>
        </div>
      </div>
      <button class="view-more" (click)="openMostActivePopup('Sôi Nổi Nhất',movies,'movies')" *ngIf="movies.length > 5">
        Xem thêm
      </button>
    </section>

    <!-- Yêu Thích Nhất -->
    <section class="grid-item">
      <h3 class="section-subtitle">
        <i class="fa-solid fa-heart-circle-check ct-icon"></i>
        YÊU THÍCH NHẤT
      </h3>
      <div class="trending-list">
        <div class="results" *ngIf="favoritesMovies.length > 0; else noResults">
          <div class="trending-item" *ngFor="let item of favoritesMovies | slice:0:5; let i = index">
            <span class="rank">{{ i + 1 }}.</span>
            <img [src]="item.posterUrl" [alt]="item.title" class="trending-thumb">
            <span class="trending-title">{{ item.title }}</span>
          </div>
          <button class="view-more" (click)="openMostActivePopup('Yêu Thích Nhất',favoritesMovies,'movies')"
                  *ngIf="favoritesMovies.length >5">Xem thêm
          </button>
        </div>
        <ng-template #noResults class="no-results">
          <p class="trending-title">Bạn chưa thêm phim nào vào danh sách yêu thích.</p>
        </ng-template>
      </div>
    </section>

    <!-- Thể Loại Hot -->
    <section class="grid-item">
      <h3 class="section-subtitle">
        <i class="fa-solid fa-bolt ct-icon"></i>
        THỂ LOẠI HOT
      </h3>
      <div class="category-list">
        <div class="category-item" *ngFor="let category of categories | slice:0:7; let i = index">
          <span class="rank">{{ i + 1 }}.</span>
          <span class="trend-icon">
            <i *ngIf="i < 3" class="fa-solid fa-arrow-trend-up" style="color: #ffd875;"></i>
            <i *ngIf="i >= 3 && i<6" class="fa-solid fa-minus"></i>
            <i *ngIf="i==6" class="fa-solid fa-arrow-trend-down" style="color:#DC328C;"></i>
          </span>
          <span class="category-badge">
            {{ category.name }}
          </span>
        </div>
      </div>
      <button class="view-more" (click)="openMostActivePopup('Thể Loại Hot',categories,'categories')"
              *ngIf="categories.length > 5">Xem thêm
      </button>
    </section>
  </div>

  <!-- Popup/Modal -->
  <app-popup
    [title]="popupTitle"
    [items]="popupItems"
    [type]="popupType"
    [isVisible]="isMostActivePopupVisible"
    (close)="closeMostActivePopup()"
  ></app-popup>

</div>
